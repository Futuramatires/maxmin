USE maxmin;

DELETE FROM aux WHERE id_interno ='ID interno';
DELETE FROM total WHERE marca ='';
DELETE FROM total WHERE marca ='marca';
DELETE FROM total WHERE diametro  ='';

DELETE FROM maxmin_marca WHERE MARCA='';
DELETE FROM maxmin_marca WHERE MARCA='Marca';
DELETE FROM maxmin_marca WHERE RIN='';

DELETE FROM maxmin_rin WHERE MARCA='';
DELETE FROM maxmin_rin WHERE MARCA='Marca';
DELETE FROM maxmin_rin WHERE RIN='';

UPDATE maxmin_marca SET STOCK=0 WHERE STOCK='';
UPDATE maxmin_marca SET M1=0 WHERE M1='';
UPDATE maxmin_marca SET M2=0 WHERE M2='';
UPDATE maxmin_marca SET M3=0 WHERE M3='';
UPDATE maxmin_marca SET M4=0 WHERE M4='';

UPDATE maxmin_rin SET STOCK=0 WHERE STOCK='';
UPDATE maxmin_rin SET M1=0 WHERE M1='';
UPDATE maxmin_rin SET M2=0 WHERE M2='';
UPDATE maxmin_rin SET M3=0 WHERE M3='';
UPDATE maxmin_rin SET M4=0 WHERE M4='';

DROP TABLE stock;

CREATE TABLE stock (ARTICULO varchar(100),STOCK varchar(100));

INSERT INTO stock SELECT DISTINCT nombre,SUM(fisico)AS STOCK FROM aux GROUP BY nombre ;
INSERT INTO stock SELECT DISTINCT articulo,SUM(total)AS STOCK FROM total GROUP BY articulo;

ALTER IGNORE TABLE stock ADD UNIQUE INDEX(ARTICULO,STOCK);

UPDATE maxmin_marca,stock SET maxmin_marca.STOCK=stock.STOCK WHERE maxmin_marca.ARTICULO=stock.ARTICULO;
UPDATE maxmin_rin,stock SET maxmin_rin.STOCK=stock.STOCK WHERE maxmin_rin.ARTICULO=stock.ARTICULO;


DROP TABLE IF EXISTS maxminmarca1;
CREATE TABLE maxminmarca1 SELECT MARCA,ARTICULO,APLICACION,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,ROUND (TOTAL/3.80) AS MINIMO,ROUND((TOTAL/3.80)*2)AS MAXIMO  FROM maxmin_marca;
SELECT * FROM maxminmarca3;


DROP TABLE IF EXISTS maxminmarca2;
CREATE TABLE maxminmarca2 SELECT MARCA,ARTICULO,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,MINIMO,MAXIMO,ROUND (MINIMO-STOCK) AS PEDMIN ,ROUND (MAXIMO-STOCK) AS PED , ROUND (TOTAL/3.80	) AS PROM FROM maxminmarca1;
SELECT * from maxminmarca2;

DROP TABLE IF EXISTS maxminmarca3;
CREATE TABLE maxminmarca3 SELECT MARCA,ARTICULO,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,MINIMO,MAXIMO,PEDMIN,PED,PROM,IF(STOCK>0,IF(PROM>0,ROUND (STOCK/PROM),0),0) AS VENTAMES FROM maxminmarca2;
SELECT * from maxminmarca3;

/**EJECUCIÃ“N DE RIN**/

DROP TABLE IF EXISTS maxminrin1;
CREATE TABLE maxminrin1 SELECT RIN,ARTICULO,APLICACION,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,ROUND (TOTAL/3.80) AS MINIMO,ROUND((TOTAL/3.70)*2)AS MAXIMO  FROM maxmin_rin;

DROP TABLE IF EXISTS maxminrin2;
CREATE TABLE maxminrin2 SELECT RIN,ARTICULO,APLICACION,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,MINIMO,MAXIMO,ROUND (MINIMO-STOCK) AS PEDMIN,ROUND (MAXIMO-STOCK) AS PED , ROUND (TOTAL/3.70) AS PROM FROM maxminrin1;

DROP TABLE IF EXISTS maxminrin3;
CREATE TABLE maxminrin3 SELECT RIN,ARTICULO,APLICACION,DESCRIPCION,
M1,M2,M3,M4,TOTAL,STOCK,MINIMO,MAXIMO,PEDMIN,PED,PROM,IF(STOCK>0,IF(PROM>0,ROUND (STOCK/PROM),0),0) AS VENTAMES FROM maxminrin2;
